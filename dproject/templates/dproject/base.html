<!DOCTYPE html>{% load staticfiles %}
<html lang="en">
  <head>
    <meta charset="utf-8">   
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Crowdsource subtitles.">
    <meta name="author" content="Aaron Snitzer">
    <link rel="shortcut icon" href="{% static "dproject/favicon.png" %}">
    <title>{% block title %}vidtest{% endblock title %}</title>
    <link href="{% static "dproject/css/bootstrap.min.css" %}" rel="stylesheet">
    <link href="{% static "dproject/css/css1.css" %}" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <!--[if lte IE 6]>
    <script>
      document.createElement("abbr");
    </script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <h1>dProject</h1>
      {% block login%}
      {% endblock login%}
      {% block content%}
      {% endblock content %}
      <div id="footer">
        Footer
      </div>
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

    <!-- Begin testing code from YT, Adobe. This is the YT recommended way to pass vid rather than iframe. -->
    <script src="//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>    
    <script>
      //aaron added for var sub in vid link
      // var vidURL = something Django here to avoid 404
      // var vidCode = vidURL
      // var vidURL = document.URL.match(/v=.........../).toString().substring(2,13);
      var vidCode = '3BJ9YXy6zQk'
      // holder for template future implementation
      var vidCode = '{{ vidId|escapejs }}'

      // embed video on page
      var params = { allowScriptAccess: 'always' };
      var atts = { id: 'myytplayer' };
      swfobject.embedSWF('http://www.youtube.com/v/' + vidCode + '?enablejsapi=1&playerapiid=ytplayer&version=3',
      // need the proper or standard vid dimensions
      'vidId', '100%', '100%', '8', null, null, params, atts);

    </script>
    <!-- End testing code from YT, Adobe. This is the YT recommended way to pass vid rather than iframe. -->

    <script>
      // load video timer display
      function onYouTubePlayerReady(playerId) {
        window.ytvid = document.getElementById('myytplayer');
        console.log('Player state ' + (ytvid.getPlayerState().toString()));
        setInterval(updateCurrentTime, 100);
        captionTime(0.0);
      }
      // the updateCurrentTime function could be made more generic maybe with video name as an argument
      function updateCurrentTime() {
        if (ytvid.getPlayerState() === 1) {
          $('#timeStamp').html(ytvid.getCurrentTime().toFixed(1));
          captionTime(ytvid.getCurrentTime());
        }
      }
      var transcript = {0: 'This a test of the CamStudio microphone.', 3: 'It\'s just dangling from my ear.', 5: 'Um, this is how we learn math.', 10: 'Whoops!', 13.0: 'Let\'s click click click delete "h."', 18.5: 'Good.', 20: '', 24.0: 'Is it not recording?', 25.8: ''};
      function captionTime(currentTime) {
        if ((transcript[Math.round(currentTime * 10) / 10]) === undefined) {          
          // console.log((Math.round(currentTime * 10) / 10) + '\tu');
        }
        else {
          $('#captions').html(transcript[Math.round(currentTime * 10) / 10]);
          // console.log((Math.round(currentTime * 10) / 10) + '\tsub');
        }
      }

      // start / stop video control
      $('#starp').click(function() {
        if (ytvid.getPlayerState() === 1) {
          ytvid.pauseVideo(); 
        }
        else {
          ytvid.playVideo();
        }
      });

      // skip back control
      $('#skipBack').click(function() {
        ytvid.seekTo((ytvid.getCurrentTime() - 1), true);
        console.log(ytvid.getCurrentTime());
      });

      // mark time with mouse click
      $('#timeClick').mousedown(function() {
        console.log(ytvid.getCurrentTime());
      });
      $('#timeClick').mouseup(function() {
        console.log(ytvid.getCurrentTime());
      });

      // find YT username
      // $('#username').html(document.getElementById('yt-masthead-user-displayname').innerHTML);

      // find vidID
      $('#vidCode').html(vidCode);

      // return to YouTube button
      $('a#returnYT').click(function() {
        return document.URL = ('//www.youtube.com/'+ vidURL);
        alert('123');
      });

      // best alternative to yt.setConfig search is search page for FEEDBACK_LOCALE_LANGUAGE
      //var userLanguage = $('script').text().match(/'FEEDBACK_LOCALE_LANGUAGE': ".*?"/).toString().match(/".*?"/).toString().replace(/\"/g, '');
      //$('#' + userLanguage).attr('selected', true);


      // not getting latest form edit content
      $('#text').keyup(function() {
        var activeForm = (document.getElementById('text').innerHTML);
        console.log(activeForm);
      });

    </script>
    <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="{% static "dproject/js/bootstrap.min.js" %}"></script>
  </body>
</html>
